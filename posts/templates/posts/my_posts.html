{% extends 'posts/base.html' %}

{% block title %}My Posts - Blog{% endblock %}

{% block content %}
<div class="container">
  <div class="page-header">
    <h1>üìù My Posts</h1>
    <p>Manage your blog posts</p>
  </div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number">{{ published_count }}</div>
      <div class="stat-label">Published</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ draft_count }}</div>
      <div class="stat-label">Drafts</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ posts.paginator.count }}</div>
      <div class="stat-label">Total Posts</div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filter-section">
    <form method="get" class="filter-form">
      <div class="form-group">
        <label>Search</label>
        <input type="text" name="q" value="{{ query }}" placeholder="Search your posts..." class="form-control">
      </div>
      <div class="form-group">
        <label>Status</label>
        <select name="status" class="form-control">
          <option value="">All</option>
          <option value="published" {% if status_filter == 'published' %}selected{% endif %}>Published</option>
          <option value="draft" {% if status_filter == 'draft' %}selected{% endif %}>Draft</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Filter</button>
      <a href="{% url 'my_posts' %}" class="btn btn-secondary">Clear</a>
    </form>
  </div>

  <!-- Posts Table -->
  {% if posts %}
  <div class="posts-table">
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th class="center">Status</th>
          <th class="center">Views</th>
          <th class="center">Comments</th>
          <th>Date</th>
          <th class="center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for post in posts %}
        <tr>
          <td>
            <a href="{% url 'post_detail' post.slug %}" class="table-post-title">
              {{ post.title }}
            </a>
          </td>
          <td>
            {% if post.category %}
            <span class="post-category">{{ post.category }}</span>
            {% else %}
            <span class="table-no-data">-</span>
            {% endif %}
          </td>
          <td class="center">
            {% if post.status == 'published' %}
            <span class="status-badge status-published">Published</span>
            {% else %}
            <span class="status-badge status-draft">Draft</span>
            {% endif %}
          </td>
          <td class="center">{{ post.views }}</td>
          <td class="center">{{ post.comments.count }}</td>
          <td class="table-date">{{ post.created_at|date:"M d, Y" }}</td>
          <td>
            <div class="table-actions">
              <a href="{% url 'post_update' post.slug %}" class="btn btn-secondary btn-sm">Edit</a>
              <a href="{% url 'post_delete' post.slug %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if posts.has_other_pages %}
  <div class="pagination">
    {% if posts.has_previous %}
    <a
      href="?page=1{% if query %}&q={{ query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">&laquo;
      First</a>
    <a
      href="?page={{ posts.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Previous</a>
    {% endif %}

    <span class="current">Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>

    {% if posts.has_next %}
    <a
      href="?page={{ posts.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Next</a>
    <a
      href="?page={{ posts.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Last
      &raquo;</a>
    {% endif %}
  </div>
  {% endif %}
  {% else %}
  <div class="empty-state">
    <h3>No posts yet</h3>
    <p>Start sharing your thoughts with the world!</p>
    <a href="{% url 'post_create' %}" class="btn btn-primary">Create Your First Post</a>
  </div>
  {% endif %}
</div>
{% endblock %}
